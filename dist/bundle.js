!function(e){var t={};function n(s){if(t[s])return t[s].exports;var a=t[s]={i:s,l:!1,exports:{}};return e[s].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(s,a,function(t){return e[t]}.bind(null,a));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);const s={mouseX:0,mouseY:0,lastX:-1,lastY:-1,mouseDown:!1,context:null,initCanvas(){const e=document.getElementById("canvas");this.context=e.getContext("2d"),e.width=310,e.height=100,this.context.fillStyle="#fff",this.context.lineWidth=2,this.context.strokeStyle="black",this.context.lineCap="round",this.draw(),this.erase()},getMousePos(e){if(!e)e=event;e.offsetX?(this.mouseX=e.offsetX,this.mouseY=e.offsetY):e.layerX&&(this.mouseX=e.layerX,this.mouseY=e.layerY)},getTouchPos(e){if(!e)e=event;if(e.touches&&1==e.touches.length){var t=e.touches[0];s.touchX=t.pageX-t.target.offsetLeft,s.touchY=t.pageY-t.target.offsetTop}},drawLine(e,t){-1==this.lastX&&(this.lastX=e,this.lastY=t),this.context.beginPath(),this.context.moveTo(this.lastX,this.lastY),this.context.lineTo(e,t),this.context.closePath(),this.context.stroke(),this.lastX=e,this.lastY=t,document.getElementById("reservation-success").style.display="inline-block"},draw(){canvas.addEventListener("mousedown",function(e){s.mouseDown=!0,s.getMousePos(e),s.drawLine(s.mouseX,s.mouseY)},!1),canvas.addEventListener("mousemove",function(e){s.getMousePos(e),!0===s.mouseDown&&s.drawLine(s.mouseX,s.mouseY)},!1),window.addEventListener("mouseup",function(){s.mouseDown=!1,s.lastX=-1,s.lastY=-1},!1),canvas.addEventListener("touchstart",function(e){s.getTouchPos(),s.drawLine(s.touchX,s.touchY),e.preventDefault()},!1),canvas.addEventListener("touchmove",function(e){s.getTouchPos(e),s.drawLine(s.touchX,s.touchY),e.preventDefault()},!1),canvas.addEventListener("touchend",function(e){s.lastX=-1,s.lastY=-1},!1)},erase(){document.getElementById("canvas-delete").addEventListener("click",function(){s.context.clearRect(0,0,canvas.width,canvas.height),document.getElementById("reservation-success").style.display="none"})}},a={buttonReservation:document.getElementById("button-reservation"),buttonReservationSuccess:document.getElementById("reservation-success"),buttonReservationDelete:document.getElementById("delete-reservation"),mapLegend:document.getElementById("map-legend"),sectionReservation:document.getElementById("section-reservation"),canvasClean:document.getElementById("canvas-delete"),alertForm:document.getElementById("alert-form"),sectionForm:document.getElementById("section-form"),reservationTitle:document.getElementById("reservation-title"),reservationTime:document.getElementById("reservation-timer"),reservationContainer:document.getElementById("reservation-container"),x:null,showReservation(){this.buttonReservation.addEventListener("click",function(){a.sectionReservation.style.display="block",a.mapLegend.style.display="none",a.buttonReservation.style.display="none",a.canvasClean.style.display="inline-block"})},reservationSuccess(e){this.buttonReservationSuccess.addEventListener("click",function(){clearInterval(a.x),s.context.clearRect(0,0,canvas.width,canvas.height),sessionStorage.setItem("name",e),a.buttonReservationSuccess.style.display="none",a.sectionForm.style.display="none",a.alertForm.style.display="block",a.alertForm.innerHTML='\n                <i class="fas fa-exclamation-triangle"></i>\n                Si vous voulez réserver un autre Vélib à une autre station, <span class="font-weight-bold">veuillez annuler la réservation en cours</span>.\n            ',a.alertForm.classList.add("alert-danger"),a.alertForm.classList.remove("alert-warning"),a.mapLegend.style.display="block",a.reservationTimer()})},reservationTimer(e){let t;t=e?(new Date).getTime()+Number(e):(new Date).getTime()+12e5,this.x=setInterval(function(){const e=(new Date).getTime(),n=t-e;let s=Math.floor(n%36e5/6e4),o=Math.floor(n%6e4/1e3);sessionStorage.setItem("temps",n),a.reservationSuccessDisplay(s,o),n<0&&a.expiredReservation()})},reservationSuccessDisplay(e,t){a.reservationContainer.classList.add("alert-success"),a.reservationContainer.classList.remove("alert-secondary"),a.reservationContainer.classList.remove("alert-danger"),a.reservationTitle.classList.remove("text-center","mb-0"),a.reservationTime.style.display="block",a.buttonReservationDelete.style.display="inline-block",a.reservationTitle.textContent=" Votre réservation est validée !",a.reservationTime.innerHTML=`Vous avez réservé 1 vélib à la station <span class="font-weight-bold">${sessionStorage.name}</span>. <br> Expire dans : <span class="font-weight-bold">${e} minute(s) et ${t} seconde(s)</span>.`},deleteReservation(){this.buttonReservationDelete.addEventListener("click",function(){a.reservationContainer.classList.remove("alert-success"),a.reservationContainer.classList.add("alert-danger"),a.reservationTitle.textContent="Votre réservation est annulée !",a.reservationTitle.classList.add("text-center","mb-0"),a.reservationTime.style.display="none",a.buttonReservationDelete.style.display="none",a.alertForm.innerHTML='\n                <i class="fas fa-exclamation-triangle"></i>\n                Veuillez sélectionner une station !\n            ',a.alertForm.classList.add("alert-warning"),a.alertForm.classList.remove("alert-danger"),clearInterval(a.x),sessionStorage.clear()})},expiredReservation(){a.reservationContainer.classList.remove("alert-success"),a.reservationContainer.classList.add("alert-danger"),a.reservationTitle.textContent="Votre réservation a expiré !",a.reservationTitle.classList.add("text-center","mb-0"),a.reservationTime.style.display="none",a.buttonReservationDelete.style.display="none",a.alertForm.innerHTML='\n            <i class="fas fa-exclamation-triangle"></i>\n            Veuillez sélectionner une station !\n        ',a.alertForm.classList.add("alert-warning"),a.alertForm.classList.remove("alert-danger"),clearInterval(a.x),sessionStorage.clear()},webStorage(){let e=sessionStorage.getItem("temps");e>0&&a.reservationTimer(e)}},o={markers:[],iconAvailable:{url:"http://maps.google.com/mapfiles/ms/icons/blue-dot.png"},iconNotAvailable:{url:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"},stationStatut:document.getElementById("station-statut"),stationBike:document.getElementById("station-bike"),formFooter:document.getElementById("form-footer"),createMarker(e){o.marker=new google.maps.Marker({position:e.position,title:e.name,map:i.map}),o.markers.push(o.marker)},createMarkerClusterer(){new MarkerClusterer(i.map,o.markers,{imagePath:"https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m"})},initIcon(e){e.available_bikes>0?this.marker.setIcon(this.iconAvailable):this.marker.setIcon(this.iconNotAvailable)},showStation(e){o.marker.addListener("click",function(){i.map.panTo(e.position),i.map.setZoom(17),(!sessionStorage.getItem("temps")||sessionStorage.getItem("temps")<0)&&(i.form.style.display="block",s.context.clearRect(0,0,canvas.width,canvas.height),document.getElementById("alert-form").style.display="none",document.getElementById("section-reservation").style.display="none",document.getElementById("canvas-delete").style.display="none",document.getElementById("reservation-success").style.display="none",document.getElementById("map-legend").style.display="block",document.getElementById("button-reservation").style.display="inline-block",document.getElementById("station-title").textContent=e.name,document.getElementById("station-street").textContent=e.address,o.showStatut(e),o.showAvailableBike(e),a.reservationSuccess(e.name))})},showStatut(e){"OPEN"===e.status?(this.stationStatut.textContent="OUVERTE",this.stationStatut.classList.add("text-success","font-weight-bold")):(this.stationStatut.textContent="FERMER",this.stationStatut.classList.add("text-danger","font-weight-bold"))},showAvailableBike(e){e.available_bikes>0?(this.stationBike.textContent=`${e.available_bikes} vélib(s) disponibles.`,this.stationBike.classList.remove("text-danger"),this.stationBike.classList.add("text-success","font-weight-bold"),this.formFooter.style.display="block"):(this.stationBike.textContent=`${e.available_bikes} vélib disponible.`,this.stationBike.classList.remove("text-success"),this.stationBike.classList.add("text-danger","font-weight-bold"),this.formFooter.style.display="none")}},i={url:"https://api.jcdecaux.com/vls/v1/stations?contract=lyon&apiKey=6ea6ca28e94413eeea15087de90e12a2462343c5",map:map,form:document.getElementById("section-form"),reservationTimer:document.getElementById("reservation-timer"),buttonReservationDelete:document.getElementById("delete-reservation"),reservationTitle:document.getElementById("reservation-title"),alertForm:document.getElementById("alert-form"),initMap(){this.map=new google.maps.Map(document.getElementById("map"),{center:{lat:45.764043,lng:4.835659},zoom:13}),this.initReservation()},initMarker(){const e=Object.create(o);var t,n,s;t=this.url,n=function(t){JSON.parse(t).forEach(t=>{e.createMarker(t),e.initIcon(t),e.showStation(t)}),e.createMarkerClusterer()},(s=new XMLHttpRequest).open("GET",t),s.addEventListener("load",function(){s.status>=200&&s.status<400?n(s.responseText):console.error(s.status+" "+s.statusText+" "+t)}),s.addEventListener("error",function(){console.error("Erreur réseau avec l'URL "+t)}),s.send(null)},initReservation(){this.form.style.display="none",this.reservationTimer.style.display="none",this.buttonReservationDelete.style.display="none",this.reservationTitle.classList.add("mb-0"),sessionStorage.getItem("name")&&sessionStorage.getItem("temps")&&(this.alertForm.innerHTML='\n            <i class="fas fa-exclamation-triangle"></i>\n            Si vous voulez réserver un autre Vélib à une autre station, <span class="font-weight-bold">veuillez annuler la réservation en cours</span>.\n        ',this.alertForm.classList.add("alert-danger"),this.alertForm.classList.remove("alert-warning"))}};window.onload=function(){i.initMap(),i.initMarker(),a.showReservation(),s.initCanvas(),a.reservationSuccess(),a.deleteReservation(),a.webStorage(),document.querySelector(".navbar").addEventListener("click",function(e){e.preventDefault();var t,n=0,s=0,a=setInterval(function(){Math.abs(t=n-s)>1?s+=t/8:(clearInterval(a),s=n),document.documentElement.scrollTop=s},10);n=document.getElementById(e.srcElement.dataset.scroll).offsetTop,s=document.documentElement.scrollTop})}}]);